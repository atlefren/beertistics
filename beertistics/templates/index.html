{% extends "layout.html" %}

{% block navbar %}
    <li id="user-info">
      <img src="{{session.user['avatar']}}"/>
      <a href="{{session.user['url']}}">{{session.user['name']}}</a>
    </li>
    <li>
      <a href="{{url_for('logout')}}">Log out</a>
    </li>
{% endblock %}

{% block content %}
  <p><em id="basic-stats-message"></em></p>

  <h1>Consumption per month</h1>
  <div style="height: 500px; margin: 10px; min-width: 100px; min-height: 100px;" id="chart1">
    <svg></svg>
  </div>
{% endblock %}

{% block script %}
  <script>
    $(document).ready(function() {

        $.getJSON("/stats/basic", function(data) {
            $("#basic-stats-message").text(basic_stats_message(data));
        });

        $.getJSON("/stats/per-month", function(test_data) {
            var chart;
            nv.addGraph(function() {
                chart = nv.models.multiBarChart()
                            .barColor(d3.scale.category20().range());

                chart.xAxis.showMaxMin(true)
                chart.yAxis.tickFormat(d3.format(',.1f'));

                d3.select('#chart1 svg')
                          .datum(test_data)
                    .transition().duration(500).call(chart);

                nv.utils.windowResize(chart.update);
                chart.dispatch.on('stateChange', function(e) { nv.log('New State:', JSON.stringify(e)); });

              return chart;
          });
        });

    });


  </script>
{% endblock %}

{% block footer %}
    <div class="footer">
        Build on data provided by <a href="http://untappd.com">Untappd</a>.
    </div>
{% endblock %}